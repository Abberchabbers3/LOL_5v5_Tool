<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Information</title>
</head>
<body>
    <h1>Player Information</h1>
    <form action="/update_player" method="POST">
        <table border="1">
            <tr>
                <th>Name</th>
                <th>Primary</th>
                <th>Rank</th>
                <th>Division</th>
            </tr>
            {% for player in players %}
            {% set player_index = loop.index0 %}
            <tr>
                <td>{{ player.name }}</td>
                {% for role_name in player.preferred_roles %}
                {% set role_index = loop.index0 %}
                <td>
                    <select name="role{{player_index}}{{loop.index0}}">
                        {% for role in roles %}
                        <option value="{{ role }}"
                                {% if role == role_name %} selected {% endif %}>
                            {{ role | capitalize }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <select name="rank{{player_index}}{{loop.index0}}">
                        {% for rank in ranks %}
                        <option value="{{ rank }}" {% if rank in player.rank_str_by_role[role_name] %} selected {% endif %}>
                            {{ rank }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <select name="division{{player_index}}{{loop.index0}}">
                        {% for division in divisions %}
                        <option value="{{ division }}" {% if division in player.rank_str_by_role[role_name] %} selected {% endif %}>
                            {{ division }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    {% if role_name == "flex" %}
                        {% set ns = namespace(total=0) %}
                        {% for other_role in player.preferred_roles[:-1] %}
                            {% set ns.total = ns.total + player.role_chances[other_role] %}
                        {% endfor %}
                        <input type="number" name="chance{{ player_index }}{{ role_index }}"
                               value="{{ 100 - ns.total }}"
                               min="0" readonly style="width: 50px;"/>
                    {% else %}
                        <input type="number" name="chance{{ player_index }}{{ role_index }}"
                               value="{{ player.role_chances[role_name] }}"
                               min="0" max = "90" step = "1" style="width: 50px;"/>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        <button type="submit">Update All Players</button>
    </form>
    <form action="/make_teams" method="POST">
    <button type="submit">Make Teams</button>
    </form>
</body>
</html>
